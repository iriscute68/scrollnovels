<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Scroll Novels</title>
    <link rel="stylesheet" href="/css/admin-dashboard.css">
</head>
<body>
    <div class="admin-container">
        <!-- Navigation -->
        <nav class="admin-nav">
            <div class="nav-brand">Admin Dashboard</div>
            <ul class="nav-links">
                <li><a href="#" data-section="dashboard" class="nav-link active">Dashboard</a></li>
                <li><a href="#" data-section="patreon" class="nav-link">Patreon Links</a></li>
                <li><a href="#" data-section="ledger" class="nav-link">Points Ledger</a></li>
                <li><a href="#" data-section="support" class="nav-link">Book Support</a></li>
                <li><a href="#" data-section="leaderboards" class="nav-link">Leaderboards</a></li>
                <li><a href="/logout" class="nav-link logout">Logout</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Dashboard Section -->
            <section id="dashboard" class="admin-section active">
                <h1>Dashboard Overview</h1>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Points Distributed</div>
                        <div class="stat-value" id="totalPointsDistributed">0</div>
                        <div class="stat-icon">üìä</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Patreon Points (This Month)</div>
                        <div class="stat-value" id="patreonDistributed">0</div>
                        <div class="stat-icon">üíé</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Points Spent (Supports)</div>
                        <div class="stat-value" id="totalSpent">0</div>
                        <div class="stat-icon">üí∏</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Active Patreon Patrons</div>
                        <div class="stat-value" id="activePatrons">0</div>
                        <div class="stat-icon">üë•</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Monthly Patrons Rewarded</div>
                        <div class="stat-value" id="patronsRewarded">0</div>
                        <div class="stat-icon">üéÅ</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Active Users (7 days)</div>
                        <div class="stat-value" id="activeUsers">0</div>
                        <div class="stat-icon">üî•</div>
                    </div>
                </div>

                <div class="dashboard-section">
                    <h2>Top Supported Books (This Month)</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Book Title</th>
                                <th>Supporters</th>
                                <th>Total Points</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="topBooksTable">
                            <tr class="loading"><td colspan="5">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Patreon Links Section -->
            <section id="patreon" class="admin-section">
                <h1>Patreon Links Management</h1>
                
                <div class="section-controls">
                    <button id="filterActiveBtn" class="btn btn-secondary">Show Active Only</button>
                    <div class="search-box">
                        <input type="text" id="patronSearch" placeholder="Search by username or email...">
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Tier</th>
                            <th>Status</th>
                            <th>Pledge (USD)</th>
                            <th>Last Reward</th>
                            <th>Supports (30d)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="patreonLinksTable">
                        <tr class="loading"><td colspan="8">Loading...</td></tr>
                    </tbody>
                </table>
                
                <div class="pagination" id="patreonPagination"></div>
            </section>

            <!-- Points Ledger Section -->
            <section id="ledger" class="admin-section">
                <h1>Points Transaction Ledger</h1>
                
                <div class="filter-controls">
                    <div class="filter-group">
                        <label>User ID</label>
                        <input type="text" id="filterUserId" placeholder="Filter by user...">
                    </div>
                    <div class="filter-group">
                        <label>Transaction Type</label>
                        <select id="filterType">
                            <option value="">All Types</option>
                            <option value="spent">Spent</option>
                            <option value="patreon_reward">Patreon Reward</option>
                            <option value="admin_adjust">Admin Adjust</option>
                            <option value="refund">Refund</option>
                            <option value="decayed">Decayed</option>
                            <option value="expired">Expired</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>From Date</label>
                        <input type="date" id="filterFrom">
                    </div>
                    <div class="filter-group">
                        <label>To Date</label>
                        <input type="date" id="filterTo">
                    </div>
                    <button id="filterLedgerBtn" class="btn btn-primary">Apply Filters</button>
                    <button id="exportCsvBtn" class="btn btn-secondary">Export CSV</button>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Type</th>
                            <th>Source</th>
                            <th>Delta</th>
                            <th>Balance After</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="ledgerTable">
                        <tr class="loading"><td colspan="6">Loading...</td></tr>
                    </tbody>
                </table>
                
                <div class="pagination" id="ledgerPagination"></div>
            </section>

            <!-- Book Support Section -->
            <section id="support" class="admin-section">
                <h1>Book Support Audit</h1>
                
                <div class="filter-controls">
                    <div class="filter-group">
                        <label>Book ID</label>
                        <input type="text" id="filterBookId" placeholder="Filter by book...">
                    </div>
                    <div class="filter-group">
                        <label>User ID</label>
                        <input type="text" id="filterSupportUserId" placeholder="Filter by user...">
                    </div>
                    <button id="filterSupportBtn" class="btn btn-primary">Apply Filters</button>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Book</th>
                            <th>Points Spent</th>
                            <th>Type</th>
                            <th>Multiplier</th>
                            <th>Effective Points</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="supportTable">
                        <tr class="loading"><td colspan="8">Loading...</td></tr>
                    </tbody>
                </table>
                
                <div class="pagination" id="supportPagination"></div>
            </section>

            <!-- Leaderboards Section -->
            <section id="leaderboards" class="admin-section">
                <h1>Leaderboards Management</h1>
                
                <div class="section-controls">
                    <button id="regenerateBtn" class="btn btn-primary">Regenerate Leaderboards</button>
                </div>

                <div class="config-section">
                    <h2>Configuration</h2>
                    
                    <div class="config-group">
                        <label>Free Points Multiplier</label>
                        <input type="number" id="freeMultiplier" step="0.1" min="0" value="1.0">
                    </div>
                    
                    <div class="config-group">
                        <label>Premium Points Multiplier</label>
                        <input type="number" id="premiumMultiplier" step="0.1" min="0" value="2.0">
                    </div>
                    
                    <div class="config-group">
                        <label>Patreon Points Multiplier</label>
                        <input type="number" id="patreonMultiplier" step="0.1" min="0" value="3.0">
                    </div>
                    
                    <div class="config-group">
                        <label>Point Decay Percentage (% per week)</label>
                        <input type="number" id="decayPercentage" step="1" min="0" max="100" value="20">
                    </div>
                    
                    <div class="config-group">
                        <label>Point Expiry Weeks</label>
                        <input type="number" id="expiryWeeks" step="1" min="1" value="4">
                    </div>
                    
                    <button id="updateConfigBtn" class="btn btn-primary">Update Configuration</button>
                </div>

                <div id="statusMessage" class="status-message"></div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2 id="confirmTitle">Confirm Action</h2>
            <p id="confirmMessage"></p>
            <div class="modal-buttons">
                <button id="confirmOkBtn" class="btn btn-primary">Confirm</button>
                <button id="confirmCancelBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <script src="/js/admin-dashboard.js"></script>
</body>
</html>
