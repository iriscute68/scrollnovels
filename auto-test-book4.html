<!DOCTYPE html>
<html>
<head>
    <title>Auto-Test Book 4 Supporters</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: Arial; background: #f5f5f5; }
        .container { max-width: 600px; margin: 20px auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .log { background: #f9f9f9; padding: 15px; border-radius: 4px; margin: 10px 0; font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto; }
        .log-item { margin: 5px 0; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
        button { background: #2196F3; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1976D2; }
        iframe { width: 100%; height: 600px; border: 2px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Auto-Test: Book 4 Supporters</h1>
        
        <div class="log" id="log">
            <div class="log-item info">Initializing test...</div>
        </div>
        
        <button onclick="location.reload()">Reload Test</button>
        
        <h2 style="margin-top: 30px;">Live Book Page (click tab manually):</h2>
        <iframe src="http://localhost/scrollnovels/pages/book.php?id=4"></iframe>
    </div>

    <script>
        const log = document.getElementById('log');
        
        function addLog(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log-item ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }
        
        // Test the API directly
        async function testAPI() {
            try {
                addLog('Testing API endpoint...', 'info');
                const response = await fetch('http://localhost/scrollnovels/api/supporters/get-top-supporters.php?author_id=1&limit=200');
                const data = await response.json();
                
                if (data.success) {
                    addLog(`API Success! Found ${data.total} supporter(s)`, 'success');
                    if (data.data && data.data.length > 0) {
                        data.data.forEach(sup => {
                            addLog(`  - ${sup.username}: ${sup.points_total} pts`, 'success');
                        });
                    }
                } else {
                    addLog(`API returned success=false: ${data.error}`, 'error');
                }
            } catch (e) {
                addLog(`API Error: ${e.message}`, 'error');
            }
        }
        
        window.addEventListener('load', () => {
            addLog('Page loaded', 'info');
            testAPI();
            addLog('Now try clicking the üèÜ Top Supporters tab in the iframe below', 'info');
            addLog('Check your browser console (F12) for detailed logs', 'info');
        });
    </script>
</body>
</html>
